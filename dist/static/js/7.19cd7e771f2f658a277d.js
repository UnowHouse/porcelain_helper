webpackJsonp([7],{NDPS:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("ZLEe"),i=s.n(a),o=s("a3Yh"),r=s.n(o),l=s("p0Vp"),n=s("xd7I"),c=s("3cXf"),d=s.n(c),f={name:"recordForm",props:{oldRecordForm:Object,isEdit:{type:Boolean,default:!1},show:{type:Boolean,default:!0}},data:function(){return{recordForm:{buildedType:"高压",productInfo:{},staffInfo:[{id:"",number:"",process:"",mealTime:"",staffName:"",processId:""}]},productList:[],staffList:[],processList:[],buildedTypeList:[{value:"高压"},{value:"滚压"},{value:"注浆"}]}},watch:{oldRecordForm:function(t){this.recordForm=t,this.loadProcesses()},buildedType:function(t){console.log(t)}},mounted:function(){var t=this;this.$api.productNameList().then(function(e){t.productList=e}),this.$api.staffNameList().then(function(e){t.staffList=e});var e=this;$("#myModal").on("hidden.bs.modal",function(){e.clear()})},methods:{submit:function(){var t=this;if(console.log(this.isEdit),this.isEdit){this.$http({method:"put",url:this.apiUrls.getUserIdPrefix()+this.apiUrls.updateRecord+this.recordForm.id,data:d()(this.recordForm),headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(){t.$emit("reload"),$.notify({title:"操作成功",message:"数据已更新至后台",icon:"fa fa-check"},{type:"success"})}).catch(function(){$.notify({title:"数据加载失败",message:"请检查网络情况或刷新重试",icon:"fa fa-close"},{type:"danger"})})}else this.$http({method:"post",url:this.apiUrls.getUserIdPrefix()+this.apiUrls.insertRecords,data:d()(this.recordForm),headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(){t.$emit("reload"),$.notify({title:"操作成功",message:"数据已更新至后台",icon:"fa fa-check"},{type:"success"})}).catch(function(){$.notify({title:"数据加载失败",message:"请检查网络情况或刷新重试",icon:"fa fa-close"},{type:"danger"})})},selectProcess:function(t){var e=this.recordForm.staffInfo[t].process;for(var s in this.processList)if(this.processList[s].process===e)return void(this.recordForm.staffInfo[t].processId=this.processList[s].id);swal("警告!","请选择或写入已存在的工序","error"),this.recordForm.processList[t].process=""},selectStaff:function(t){var e=this.recordForm.staffInfo[t].staffName;for(var s in this.staffList)if(this.staffList[s].staffName===e)return void(this.recordForm.staffInfo[t].id=this.staffList[s].id);swal("警告!","请选择或写入已存在的员工","error"),this.recordForm.staffInfo[t].staffName=""},loadProcesses:function(){var t=this,e=this.recordForm.productInfo.productName;for(var s in this.productList)if(this.productList[s].productName===e)return this.recordForm.productInfo.id=this.productList[s].id,void this.$api.productProcessesList({productId:this.productList[s].id}).then(function(e){t.processList=e});swal("警告!","请选择或写入已存在的货品名称","error"),this.recordForm.productInfo.productName=""},addWorker:function(){this.recordForm.staffInfo.push({id:"",number:"",process:"",staffName:"",processId:""})},removeWorker:function(t){this.recordForm.staffInfo.splice(t,1)},clear:function(){this.recordForm={buildedType:"高压",productInfo:{},staffInfo:[{id:"",number:"",process:"",staffName:"",processId:""}]}}}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal fade",attrs:{id:"myModal",tabindex:"-10000",role:"dialog","aria-labelledby":"myModalLabel","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content",staticStyle:{"padding-bottom":"0px"}},[t._m(0),t._v(" "),s("div",{staticClass:"modal-body"},[s("form",{staticClass:"form-horizontal",attrs:{id:"form-data",action:"#"}},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"control-label col-xs-3 col-sm-3 col-md-3"},[t._v("品名")]),t._v(" "),s("div",{staticClass:"col-xs-6 col-sm-6 col-md-6"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.recordForm.productInfo.productName,expression:"recordForm.productInfo.productName"}],staticClass:"product_name form-control",attrs:{type:"text",list:"product-list",placeholder:"输入或选择陶瓷品名"},domProps:{value:t.recordForm.productInfo.productName},on:{blur:t.loadProcesses,input:function(e){e.target.composing||t.$set(t.recordForm.productInfo,"productName",e.target.value)}}}),t._v(" "),s("datalist",{attrs:{id:"product-list"}},t._l(t.productList,function(e,a){return s("option",{key:a},[t._v("\n                        "+t._s(e.productName)+"\n                      ")])}),0)])]),t._v(" "),s("div",{staticClass:"form-group"},[s("label",{staticClass:"control-label col-xs-3 col-sm-3 col-md-3"},[t._v("成型工艺")]),t._v(" "),s("div",{staticClass:"col-xs-9 col-sm-9 col-md-9"},t._l(t.buildedTypeList,function(e,a){return s("div",{key:a,staticClass:"radio-inline"},[s("label",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.recordForm.buildedType,expression:"recordForm.buildedType"}],attrs:{type:"radio"},domProps:{value:e.value,checked:t._q(t.recordForm.buildedType,e.value)},on:{change:function(s){return t.$set(t.recordForm,"buildedType",e.value)}}}),t._v(t._s(e.value)+"\n                      ")])])}),0)]),t._v(" "),t.isEdit?t._e():s("div",{staticClass:"form-group"},[s("label",{staticClass:"control-label col-xs-3 col-sm-3 col-md-3"},[t._v("操作")]),t._v(" "),s("div",{staticClass:"col-xs-9 col-sm-9 col-md-9"},[s("a",{staticClass:"add_worker btn btn-info",attrs:{href:"javascript:void(0)"},on:{click:t.addWorker}},[s("i",{staticClass:"fa fa-lg fa-plus"}),t._v("添加工作者")])])]),t._v(" "),s("div",{attrs:{id:"worker_list"}},t._l(t.recordForm.staffInfo,function(e,a){return s("div",{key:a,staticClass:"worker_info"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:" control-label col-xs-3 col-sm-3 col-md-3"},[t._v("\n                      工作者"+t._s(a+1))]),t._v(" "),s("div",{staticClass:"col-sm-3 col-md-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.staffName,expression:"item.staffName"}],staticClass:"worker_name form-control col-xs-8 col-sm-8 col-md-8",attrs:{type:"text",list:"staff-list",placeholder:"输入工作者名称"},domProps:{value:e.staffName},on:{blur:function(e){return t.selectStaff(a)},input:function(s){s.target.composing||t.$set(e,"staffName",s.target.value)}}})]),t._v(" "),s("div",{staticClass:"col-sm-3 col-md-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.mealTime,expression:"item.mealTime"}],staticClass:"worker_name form-control col-xs-8 col-sm-8 col-md-8",attrs:{type:"number",placeholder:"用餐次数"},domProps:{value:e.mealTime},on:{input:function(s){s.target.composing||t.$set(e,"mealTime",s.target.value)}}})]),t._v(" "),a>0?s("a",{staticClass:"remove_worker btn btn-warning",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.removeWorker(a)}}},[s("i",{staticClass:"fa fa-lg fa-minus"})]):t._e()]),t._v(" "),s("div",{staticClass:"form-group"},[s("label",{staticClass:"control-label col-xs-3 col-sm-3 col-md-3"},[t._v("\n                        工作者"+t._s(a+1)+"的工作")]),t._v(" "),s("div",{staticClass:"col-sm-3 col-md-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.process,expression:"item.process"}],staticClass:"uphand process form-control",attrs:{type:"text",list:"process-list",placeholder:"工序"},domProps:{value:e.process},on:{blur:function(e){return t.selectProcess(a)},input:function(s){s.target.composing||t.$set(e,"process",s.target.value)}}})]),t._v(" "),s("div",{staticClass:"col-xs-3 col-sm-3 col-md-3"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.number,expression:"item.number"}],staticClass:"done_num form-control",attrs:{type:"number",placeholder:"数量"},domProps:{value:e.number},on:{input:function(s){s.target.composing||t.$set(e,"number",s.target.value)}}})])])])}),0),t._v(" "),s("datalist",{attrs:{id:"staff-list"}},t._l(t.staffList,function(e,a){return s("option",{key:a},[t._v("\n                    "+t._s(e.staffName)+"\n                  ")])}),0),t._v(" "),s("datalist",{attrs:{id:"process-list"}},t._l(t.processList,function(e,a){return s("option",{key:a},[t._v("\n                    "+t._s(e.process)+"\n                  ")])}),0)])]),t._v(" "),s("div",{staticClass:"modal-footer"},[t._m(1),t._v(" "),s("button",{staticClass:"btn btn-primary",attrs:{"data-dismiss":"modal",type:"button"},on:{click:t.submit}},[s("i",{staticClass:"fa fa-fw fa-lg fa-check-circle"}),t._v("\n                "+t._s(t.isEdit?"修改":"确定")+"\n              ")])])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-header",staticStyle:{border:"none"}},[e("div",{staticClass:"modal-title"},[this._v("添加工作记录")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("button",{staticClass:"btn btn-default icon-btn",attrs:{"data-dismiss":"modal"}},[e("i",{staticClass:"fa fa-fw fa-lg fa-times-circle"}),this._v("取消")])}]},u=s("C7Lr")(f,m,!1,null,null,null).exports;n.a.component("item-action",l.a);var p={components:{"record-form":u},name:"record",props:{barLoad:Boolean},data:function(){var t;return{isEdit:!1,recordForm:{buildedType:"",productInfo:{},staffInfo:[]},styleWidth:"",pageIndex:1,pageSize:10,total:0,sortBy:"",sortType:"",key:"",isLoading:!1,multipleSort:!1,tableConfig:{tableData:[],columns:[{field:"staffName",title:"员工姓名",titleAlign:"center",width:80,columnAlign:"center",isResize:!0},{field:"productNum",title:"货品编号",titleAlign:"center",width:80,columnAlign:"center",isResize:!0},{field:"productName",title:"货物品名",titleAlign:"center",width:80,columnAlign:"center",isResize:!0},{field:"buildedType",title:"成型工艺",titleAlign:"center",width:80,columnAlign:"center",isResize:!0},{field:"mealTime",title:"用餐次数",titleAlign:"center",width:40,columnAlign:"center",isResize:!0},{field:"process",title:"工序",titleAlign:"center",width:80,columnAlign:"center",isResize:!0},{field:"number",title:"数量",titleAlign:"center",orderBy:"desc",width:80,columnAlign:"center",isResize:!0},{field:"created",title:"日期",titleAlign:"center",orderBy:"desc",width:160,columnAlign:"center",isResize:!0},(t={field:"custome-adv",title:"操作",titleAlign:"center",width:160},r()(t,"titleAlign","center"),r()(t,"columnAlign","center"),r()(t,"componentName","item-action"),r()(t,"isResize",!0),t)]}}},created:function(){this.getTableData()},watch:{barLoad:function(){var t=this,e=this.tableConfig.tableData;this.isLoading=!0,this.tableConfig.tableData=[],setTimeout(function(){t.tableConfig.tableData=e,t.isLoading=!1},400)},key:function(t){t||this.getTableData()}},methods:{transferDate:function(t){for(var e in t)t[e].created=this.Filters.timeFormat(t[e].created);return t},getTableData:function(){var t=this;this.isLoading=!0;var e={page:this.pageIndex,rows:this.pageSize,sortBy:this.sortBy,sortType:this.sortType,key:this.key};this.$api.recordList(e).then(function(e){e.datas=t.transferDate(e.datas),t.tableConfig.tableData=e.datas,t.total=e.total,t.isLoading=!1}).catch(function(e){t.isLoading=!1})},pageChange:function(t){this.pageIndex=t,this.getTableData()},pageSizeChange:function(t){this.pageIndex=1,this.pageSize=t,this.getTableData()},customCompFunc:function(t){"delete"===t.type?this.deleteStaff(t.id):"edit"===t.type&&(this.isEdit=!0,this.recordForm={id:t.rowData.id,productInfo:{productName:t.rowData.productName,productNum:t.rowData.productNum},buildedType:t.rowData.buildedType,staffInfo:[{staffName:t.rowData.staffName,process:t.rowData.process,number:t.rowData.number}]},$("#myModal").modal("show"))},sortChange:function(t){var e=this,s=this;i()(t).forEach(function(a){t[a]&&(s.sortBy=a,s.sortType=t[a],e.getTableData())})},addRecord:function(){this.isEdit=!1},deleteStaff:function(t){var e=this;this.$api.deleteRecord(t).then(function(t){e.getTableData(),swal("删除成功!","该条记录已被永久性移除","success")})}}},v={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t._m(0),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-12"},[s("div",{staticClass:"card"},[s("div",{staticClass:"card-body",attrs:{id:"card-body"}},[s("div",{staticClass:"row"},[s("ul",{staticClass:"col-sm-6 bread-li"},[s("li",{attrs:{"data-toggle":"modal","data-target":"#myModal"},on:{click:t.addRecord}},[t._m(1)])]),t._v(" "),s("ul",{staticClass:"col-sm-6 bread-li right-bread"},[s("li",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.key,expression:"key"}],staticClass:"form-control",attrs:{type:"text",placeholder:"输入关键字搜索"},domProps:{value:t.key},on:{change:function(t){},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getTableData(e)},input:function(e){e.target.composing||(t.key=e.target.value)}}})]),t._v(" "),s("li",[s("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.getTableData}},[s("i",{staticClass:"fa fa-fw fa-lg fa-search"}),t._v(" 搜索\n\t\t                ")])])])]),t._v(" "),s("div",{staticClass:"row"},[s("v-table",{staticClass:"table-responsive",staticStyle:{width:"100%"},attrs:{"is-loading":t.isLoading,"is-horizontal-resize":"","column-width-drag":"","multiple-sort":t.multipleSort,columns:t.tableConfig.columns,"table-data":t.tableConfig.tableData,"paging-index":(t.pageIndex-1)*t.pageSize,"row-hover-color":"#eee","row-click-color":"#edf7ff"},on:{"sort-change":t.sortChange,"on-custom-comp":t.customCompFunc}})],1),t._v(" "),s("div",{staticClass:"row v-pagin"},[s("v-pagination",{attrs:{total:t.total,"page-size":t.pageSize,layout:["total","prev","pager","next","sizer","jumper"]},on:{"page-change":t.pageChange,"page-size-change":t.pageSizeChange}})],1)])])])]),t._v(" "),s("record-form",{attrs:{oldRecordForm:t.recordForm,isEdit:t.isEdit},on:{reload:t.getTableData}})],1)},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-title"},[s("div",[s("h1",[s("i",{staticClass:"fa fa-laptop"}),t._v("员工的工作记录")]),t._v(" "),s("p",[t._v("录入或修改我的员工的工作记录")])]),t._v(" "),s("div",[s("ul",{staticClass:"breadcrumb"},[s("li",[s("i",{staticClass:"fa fa-database fa-lg"})]),t._v(" "),s("li",[t._v("管理")]),t._v(" "),s("li",[s("a",{attrs:{href:"#/staffs"}},[t._v("工作记录信息")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("a",{staticClass:"btn btn-primary",attrs:{href:"javascript:void(0)"}},[e("i",{staticClass:"fa fa-lg fa-plus"}),this._v("添加")])}]},h=s("C7Lr")(p,v,!1,null,null,null);e.default=h.exports}});